# 用前先看！！！

### 1.起始时钟

需要在初始化下面加一个这个代码，有的不需要有的需要，看个人的情况，我不加就会卡死白屏。
![image-20231001171823284](C:\Users\86182\Desktop\pit\image-20231001171823284.png)

![img](C:\Users\86182\Desktop\pit\KXS_HT1UHGD2UFAFQAGWWGK.jpg)

## 2.cs片选

我cs片选信号和Tcs的片选信号全是初始化的时候就Pull_Down了，因为我只用一个显示屏，所以我把代码中的CS控制电平的全删除了。
![image-20231001172100322](C:\Users\86182\Desktop\pit\image-20231001172100322.png)

## 3.信号写入

​	这个地方我的这个LCD貌似必须要等总线不忙碌才行，我之前试了试，单SR寄存器的TXE判断是否发送缓存为空，去掉下面的BSY我的程序就会卡死，改成SPI_FLAG_RXNE也会卡死程序。

这一点我现在还没想明白为什么，但是大胆猜测一下，首先大部分配置的时候都是用的8bit传输，手册对于DR寄存器的描述如下图，可以看到，对于8位的数据位是只有8个寄存器来存储数据的，我发出数据后数据首先会来到DR寄存器，然后由单片机完成这个操作，因为单片机是一位一位发，然后依次移出DR寄存器，最后一位移除后，还在传输TXE就让单片机再发，而spi这时候还在通信忙碌导致通信时序紊乱了。这是猜想，因为正常来说32只要txe好了，肯定不会在BUSY。反正按着我的改没问题。

![image-20231001172858001](C:\Users\86182\Desktop\pit\image-20231001172858001.png)

![image-20231001172130882](C:\Users\86182\Desktop\pit\image-20231001172130882.png)

## 4.cubemx配置

配置按照我给的cubemx配置即可，我是最新版的cubemx，所以如果你版本比我老的话，请更新才能打开。然后记得一定要改引脚的名称，因为我用的都是宏定义。

## 5.优化程序

对于引脚和时序的操作我都用的是寄存器的方式操作，时序方面我也是修改了部分地方，然后优化部分就是LCD_SPI_Send部分，你可以先尝试删去第二个While，这个while去掉可以让程序快很多！很多！，然后还有一个地方就是发送半字的地方16bit，这个地方也可以优化但是前提是把send部分优化好，然后GUI函数部分和touch部分的函数我没有更改，因为我做这个是为了后面学习LVGL，所以如果你要用这个GUI，想要高刷，这部分可以参考正点原子的LCD程序修改。

# all in all 希望这个代码能帮到你